name: Poutine security scanner

permissions: {}

on:
  workflow_call:
  workflow_dispatch:


jobs:
  analysis:
    name: Poutine analysis
    runs-on: ubuntu-latest
    permissions:
      # Needed to upload the results to code-scanning dashboard.
      security-events: write
      contents: read

    steps:
      - name: "Checkout code"
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # pin@v4

      - name: "Run analysis"
        uses: boostsecurityio/poutine-action@3185069445660817a88ecec700304f0748086c60 # pin@v0.17.0

      # Upload the results as artifacts (optional). Commenting out will disable uploads of run results in SARIF
      # format to the repository Actions tab.
      - name: "Upload artifact"
        uses: actions/upload-artifact@834a144ee995460fba8ed112a2fc961b36a5ec5a # pin@v4
        with:
          name: SARIF file
          path: results.sarif
          retention-days: 28

      # Upload the results to GitHub's code scanning dashboard.
      - name: "Upload to code-scanning"
        uses: github/codeql-action/upload-sarif@2c779ab0d087cd7fe7b826087247c2c81f27bfa6 # pin@v3
        with:
          sarif_file: results.sarif
